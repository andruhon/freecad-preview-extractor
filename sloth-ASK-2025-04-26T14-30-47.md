# ES Modules Conversion

✅ Here's the code converted to ES Modules:

```javascript
import fs from 'fs';
import path from 'path';
import yauzl from 'yauzl';
import { promisify } from 'util';
import mkdirp from 'mkdirp';
import glob from 'glob';
import { execSync } from 'child_process';

// Convert callback-based glob to promise-based
const globPromise = promisify(glob);

// Helper to promisify yauzl's zip opening
function openZipPromise(filename) {
  return new Promise((resolve, reject) => {
    yauzl.open(filename, { lazyEntries: true }, (err, zipfile) => {
      if (err) return reject(err);
      resolve(zipfile);
    });
  });
}

// Helper to read a specific file from a zip archive
async function extractPngFromZip(zipFilePath, outputPath) {
  const zipfile = await openZipPromise(zipFilePath);
  let foundPng = false;
  
  return new Promise((resolve, reject) => {
    zipfile.on('entry', (entry) => {
      // Look for PNG files in the zip
      if (entry.fileName.toLowerCase().endsWith('.png')) {
        console.log(`✅ Found PNG in ${path.basename(zipFilePath)}: ${entry.fileName}`);
        foundPng = true;
        
        zipfile.openReadStream(entry, (err, readStream) => {
          if (err) {
            zipfile.close();
            return reject(err);
          }
          
          const writeStream = fs.createWriteStream(outputPath);
          readStream.pipe(writeStream);
          
          writeStream.on('close', () => {
            console.log(`✅ Extracted to: ${outputPath}`);
            zipfile.readEntry();
          });
          
          writeStream.on('error', (err) => {
            zipfile.close();
            reject(err);
          });
        });
      } else {
        zipfile.readEntry();
      }
    });
    
    zipfile.on('end', () => {
      if (!foundPng) {
        console.log(`⚠️ No PNG files found in ${path.basename(zipFilePath)}`);
      }
      resolve(foundPng);
    });
    
    zipfile.on('error', (err) => {
      reject(err);
    });
    
    zipfile.readEntry();
  });
}

// Main function
async function main() {
  try {
    // Find all .fcstd files in the current directory and subdirectories
    const fcstdFiles = await globPromise('**/*.fcstd');
    
    if (fcstdFiles.length === 0) {
      console.log('❌ No .fcstd files found');
      return;
    }
    
    console.log(`✅ Found ${fcstdFiles.length} .fcstd files to check`);
    
    for (const file of fcstdFiles) {
      try {
        // Prepare output path - same directory, same name but with .png extension
        const dir = path.dirname(file);
        const baseName = path.basename(file, '.fcstd');
        const pngPath = path.join(dir, `${baseName}.png`);
        
        // Try to extract PNG from the file treating it as a ZIP
        await extractPngFromZip(file, pngPath);
        
      } catch (err) {
        console.log(`❌ Error processing ${file}: ${err.message}`);
      }
    }
    
  } catch (err) {
    console.error('❌ Error:', err);
  }
}

// Install required dependencies (if not installed)
async function checkDependencies() {
  const requiredPackages = ['yauzl', 'glob', 'mkdirp'];
  
  for (const pkg of requiredPackages) {
    try {
      // In ESM, we can't use require.resolve directly
      await import(pkg);
    } catch (e) {
      console.log(`⚠️ Required package ${pkg} not found. Installing...`);
      execSync(`npm install ${pkg}`, { stdio: 'inherit' });
    }
  }
}

// Run the script
(async () => {
  await checkDependencies();
  await main();
})();
```

⚠️ **Important Notes**:

1. You'll need to add `"type": "module"` to your package.json file or save the file with a `.mjs` extension to indicate it's an ES module.

2. The dependency checking mechanism is modified since `require.resolve` isn't directly available in ES modules. The new approach uses dynamic imports to check for package availability.

3. The glob library is imported directly and then promisified, rather than requiring and then promisifying in a single line.

4. You might need to install the newer versions of these packages that support ESM if you encounter any issues.